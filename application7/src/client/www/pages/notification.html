<template>
<div class="page" data-name="home">
  <div class="appbar">
    <div class="left">
      <a href="#" class="button" @click ='previouspage'>
        <i class="icon icon-back"></i>
        Home
        <span class="if-not-md">Back</span>
      </a>
    </div>
  </div>

  <!-- Scrollable page content-->
  <div class="page-content">
    <div class="block-title">Demande d'ajout re√ßues</div>
      <div class="list links-list">
        <ul>
          {{#each myfriends}}
            <li>{{pseudo}}  </li>
              <div class="block block-strong row">
                <div class="col"><a class="button convert-form-to-data" href="#" @click="accepter('{{id}}','{{pseudo}}')">Accepter l'invitation</a></div>
                <div class="col"><a class="button convert-form-to-data" href="#" @click="refuser('{{id}}','{{pseudo}}')">Refuser l'invitation</a></div>
              </div>
          {{/each}}
        </ul>
      </div>
    </div>
  </div>
</template>
<script>
return{
  async data(){
    var myfriends = [];
    try {
      myfriends = await app.methods.tokenHandlingFetch("/friends/received/pending")
          .then(res => res.json())
    }
    catch(err) {
      app.dialog.alert("Error " + err);
    }
    finally{
      return {myfriends : myfriends};
    }
  },
  methods : {
    accepter: function(id, pseudo){
        app.methods.tokenHandlingFetch(  "/friend/accept/"+id, {method: 'PUT'})
          .then(() => {
            app.dialog.alert(pseudo+ " is now in your friend list.")
            this.$router.navigate('/friendlist');
          })
          .catch(err => app.dialog.alert('Error ' + err))
    },
    refuser: function(id, pseudo){
          app.methods.tokenHandlingFetch( "/friend/refuse/"+id, { method: 'PUT'})
          .then(() => {
            app.dialog.alert("You refused the friend's request of " +  pseudo)
            this.$router.navigate('/friendlist');
          })
          .catch(err => app.dialog.alert('Error ' + err))

    },
    previouspage:function(){
      this.$router.navigate('/home');
    }
  }
}
</script>
