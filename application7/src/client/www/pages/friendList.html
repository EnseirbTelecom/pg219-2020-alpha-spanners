<template>
<div class="page" data-name="home">
  <div class="appbar">
    <div class="appbar-inner">
      <div class="left">
        <a href="#" class="link icon-only panel-open" data-panel="left">
          <i class="icon f7-icons if-not-md">menu</i>
          <i class="icon material-icons if-md">menu</i>
        </a>
      </div>
    </div>
  </div>

  <!-- Scrollable page content-->
   <div class="page-content">

    <div class="block-title">Liste des amis</div>
      <div class="list links-list">
        <ul>
          {{#each friends}}
          {{#js_if "this.senderId ===  app.data.user.id"}}
            <a href="#"><li>{{receiverSurname}} {{receiverName}} </li></a>
            <div class="block block-strong row">
              <div class="col"><a class="button convert-form-to-data" href ='#' @click="delete('{{senderId}}','{{receiverId}}','{{status}}')">Delete {{receiverSurname}}</a></div>
            </div>
          {{else}}
            {{#js_if "this.receiverId === app.data.user.id"}}
            <a href="#"><li>{{senderSurname}} {{senderName}} </li></a>
            <div class="block block-strong row">
              <div class="col"><a class="button convert-form-to-data" href ='#' @click="delete('{{senderId}}','{{receiverId}}','{{status}}')">Delete {{senderSurname}}</a></div>
            </div>
            {{/js_if}}
          {{/js_if}}
          {{/each}
        </ul>
      </div>
    </div>

   </div>
</div>
</template>
<script>
return {
  async data() {
    let friends = [];
    try {
      friends = await fetch( app.data.serverAddress +"/friendlist/" + app.data.user.id)
        .then(res => res.json())
    }catch(err) {
      app.dialog.alert("Error " + err);
    }
    finally{
      return { friends: friends };
    }
  },
  methods: {
    delete : function(idexp,iddest,status){
      fetch( app.data.serverAddress +"/removefriend/" + idexp + '/' + iddest , {
          method: "DELETE",
      })
      .catch(err => app.dialog.alert('Error ' + err))
      .finally(() => {
          this.$router.navigate('/home');
      });
    },
    previouspage : function(){
      this.$router.navigate('/addfriends');
    },
    monprofil : function(){
      this.$router.navigate('/home');
    }
  }
}
</script>
