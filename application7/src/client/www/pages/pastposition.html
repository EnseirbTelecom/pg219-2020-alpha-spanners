<template>
<div class="page" data-name="pastposition">
  <!-- Appbar -->
  <div class="appbar">
    <div class="appbar-inner">
      <div class="left">
        <a href="#" class="link icon-only panel-open" data-panel="left">
          <i class="icon f7-icons if-not-md">menu</i>
          <i class="icon material-icons if-md">menu</i>
        </a>

      </div>
     
    </div>
  </div>
  
  <!-- Scrollable page content-->
  <div class="page-content">
    
      <div class="title-big-text">
        <h1>History</h1>
      </div>

    <div class="block-title">Swipe left for more options</div>

    <div class="list media-list">
      <ul>
        {{#each pastpositions}}

          <li class="swipeout deleted-callback">
            <div class="swipeout-content">
              <a href="#" class="item-link item-content">
              <div class="item-inner">
                <div class="item-title-row">
                  <div class="item-title">{{dateTime}}</div>
                  <div class="item-after">17:14</div>
                </div>
                <div class="item-text">
                  <b>Lat</b>: {{latitude}} <br> <b>Long</b>: {{longitude}}  
                </div>
              </div>
              </a>
            </div>
            <div class="swipeout-actions-right">
              <a href="#" class="swipeout-delete" @click="delete('{{_id}}')">Delete</a>
              <a href="#" class="color-green alert-reply " @click="positionOnmap('{{_id}}')">On Map</a>
            </div>
          </li>


        {{/each}}
      </ul>
    </div>
  </div>
</div>
</template>
<script>

return {
  async data (){
    let pastpositions = [];
      try {
        pastpositions = await fetch(app.data.serverAddress + "/pastpositions/" + app.data.user.id)
          .then(res => res.json());
      } catch(err) {
        this.$app.dialog.alert("Error " + err);
      }
      return { pastpositions: pastpositions };
  },
  methods:{
    submit:function(){
      this.$router.navigate('/home');
    },
    delete : function(idposition){
        fetch( app.data.serverAddress +"/deletedposition/"  + idposition , {
            method: "DELETE",
        })
        .catch(err => app.dialog.alert('Error ' + err))
        app.dialog.alert('This position has been deleted')
        this.$router.navigate('/home');
    },
    positionOnmap : function(id){
      this.$router.navigate(
        {
          name:'latlngOnmap',
          params: {idposition : id},
        });
    },

  },

}
</script>
