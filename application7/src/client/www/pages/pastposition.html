<template>
<div class="page" data-name="pastposition">
  <!-- Appbar -->
  <div class="appbar">
    <div class="left">
      <a class="button" href="/home">
        <i class="icon icon-back"></i>
        Friends
        <span class="if-not-md">Back</span>
      </a>
    </div>
  </div>
  <!-- Scrollable page content-->
  <div class="page-content">
    <div class="block-title">My past positions</div>

      <div class="list links-list">
        <ul>
          {{#each pastpositions}}
          <a href="#"><li>Cette position (latitude : {{latitude}} , longitude : {{longitude}}) a été activée à {{dateTime}} , je l'ai désormais désactivée </li></a>
          <div class="block block-strong row">
            <div class="col"><a class="button convert-form-to-data" href ='#' @click="delete('{{_id}}')">Delete position</a></div>
          </div>
          <div class="block block-strong row">
            <div class="col"><a class="button convert-form-to-data" href ='#' @click="positionOnmap('{{_id}}')">Visualize on a map</a></div>
          </div>
          {{/each}}
        </ul>
      </div>
    </div>

    <div class="block block-strong row">
       <div class="col"><a class="button convert-form-to-data" href="#" @click='submit'>Return home</a></div>
    </div>

  </div>
</div>
</template>
<script>

return {
  async data (){
      try {
        const pastpositions = await app.methods.tokenHandlingFetch("/pos/past" )
          .then(res => res.json());
      } catch(err) {
        this.$app.dialog.alert("Error " + err);
      }
      return { pastpositions: pastpositions };
  },
  methods:{
    submit:function(){
      this.$router.navigate('/home');
    },
    delete : function(idposition){
      app.methods.tokenHandlingFetch( "/pos/delete/"  + idposition , { method: "DELETE",})
        .then(resp => {
          app.dialog.alert('This position has been deleted')
          this.$router.navigate('/pastpositions');
        })
        .catch(err => app.dialog.alert('Error ' + err))

    },
    positionOnmap : function(id){
      this.$router.navigate(
        {
          name:'latlngOnmap',
          params: {idposition : id},
        });
    }
  }
}
</script>
